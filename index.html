<!doctype html>
<html class="no-js" lang="en-CA">

<head>
  <meta charset="utf-8">
  <title>Blood Pressure Log</title>
  <meta name="description" content="blood pressure log">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">-->

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="./css/normalize.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.20/c3.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="./css/main.css">

  <meta name="theme-color" content="#fafafa">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.20/c3.min.js"></script>
  <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.js" charset="utf-8"></script>
  <script src="https://kit.fontawesome.com/dac74a2b0e.js" crossorigin="anonymous"></script>
</head>

<body>
  <main>
    <!-- Add your site or application content here -->
    <h1>Blood Pressure Tracker</h1>

    <nav>
      <a href="./viz/"><i class="fa-regular fa-chart-bar"></i> Visualizations</a>
    </nav>
    <div class="latest">

      <div id="latest-sys"></div>
      <div id="latest-dia"></div>
      <div id="latest-hr"></div>
      <div id="latest-mood"></div>
      <div id="latest-note"></div>
      <div id="latest-date"></div>
    </div>
    <table id="bpTable" class="table">
      <thead>
        <tr>
          <th>Timestamp</th>
          <th>Systolic Blood Pressure (mmHg)</th>
          <th>Diastolic Blood Pressure (mmHg)</th>
          <th>Heart Rate (bpm)</th>
          <th>How are you feeling?</th>
          <th>Notes</th>
        </tr>
      </thead>
    </table>
  </main>


  <script>
    $(document).ready(function() {
      // Google Sheets setup

      var sheetsAPIdomain = 'https://content-sheets.googleapis.com/v4/spreadsheets/';
      var sheetID = '1G5kHapZPUTEb-KdprovtyxvJhSP5sJiz3--bRr-yQsY';
      var sheetRange = 'A1:F1000';
      var params = $.param({
        // valueRenderOption: 'FORMATTED_VALUE',
        dateTimeRenderOption: 'SERIAL_NUMBER',
        key: 'AIzaSyAarlySPKJgCGqmRqPvCBi547QvegAMrTE',
        majorDimension: 'ROWS'
      });

      requestURL = sheetsAPIdomain + sheetID + '/values/' + sheetRange + '?' + params;

      $.ajax({
        url: requestURL,
      }).done(function(response) {
        console.log(response);
        var sheetRows = response.values;
        var cleanData = [];
        sheetRows.forEach((item, i) => {
          if (i > 0) {
            // console.log(item.length)
            if (item.length == 5) {
              item.push("");
            } else if (item.length == 4) {
              item.push("", "");
            } else if (item.length == 3) {
              item.push("", "", "");
            } else if (item.length == 2) {
              item.push("", "", "", "");
            } else if (item.length == 1) {
              item.push("", "", "", "", "");
            }

            // eventDate = item[0];
            // var monthName = moment(eventDate).format("MMMM").toUpperCase();
            // var monthDate = moment(eventDate).format("DD");
            // var time = moment(eventDate).format("HH:mm");
            //
            // console.log(monthName + ' ' + monthDate + ' ' + time);
            cleanData.push(item);

          }

        });

        // console.log(cleanData)


        var table = $('#bpTable').DataTable({
          data: cleanData,
          columns: [{
              "type": "date",
              "orderable": false,
              "render": function(data, type, row) {
                var monthName = moment(data).format("MMMM").toUpperCase();
                var monthDate = moment(data).format("DD");
                var time = moment(data).format("HH:mm");
                // var markup="";
                // markup += "<div class='date-box'>";
                // markup += "<span class='date-month'>"+monthName+"</span>";
                // markup += "<span class='date-day'>"+monthDate+"</span>";
                // markup += "<span class='date-time'>"+time+"</span>";
                // markup += "</div>";
                // return markup;
                return monthName + ' ' + monthDate + ' ' + time;
                // return data + ' (' + row[3] + ')';
              },
              "name": "date"
            },
            {
              "type": "num",
              "orderable": false
            },
            {
              "type": "num",
              "orderable": false
            },
            {
              "type": "num",
              "orderable": false
            },
            {
              "type": "num",
              "orderable": false,
              "render": function(data, type, row) {
                if (data == 1) {
                  return 'üò´'
                } else if (data == 2) {
                  return 'üòï'
                } else if (data == 3) {
                  return 'üôÇ'
                } else if (data == 4) {
                  return 'üòÄ'
                } else if (data == 5) {
                  return 'üòÅ'
                } else {
                  return '';
                }
              },
              "name": "mood"
            },
            {
              "type": "string"
            },
          ],
          order: [
            [0, 'desc']
          ],
          dom: 'lrtip'
        });

        var d = table.row(':eq(0)').data();
        $('#latest-date').html('<span>' + d[0] + '</span>');
        $('#latest-sys').html('<span class="digital">' + d[1] + '</span><span class="unit">mmHg</span>');
        $('#latest-dia').html('<span class="digital">' + d[2] + '</span><span class="unit">mmHg</span>');
        $('#latest-hr').html('<span>' + d[3] + '</span><span class="unit">bpm</span>');
        $('#latest-mood').html('<span>' + d[4] + '</span>');
        $('#latest-note').html('<span>' + d[5] + '</span>');
        console.log(d);

      });

    });
  </script>



  <script src="js/vendor/modernizr-3.11.2.min.js"></script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>

</body>

</html>
